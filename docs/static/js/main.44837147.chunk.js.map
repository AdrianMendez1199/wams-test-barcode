{"version":3,"sources":["index.js"],"names":["handleResize","width","document","documentElement","clientWidth","height","clientHeight","video","getElementById","canvas","videoWidth","videoHeight","style","init","a","window","onresize","navigator","mediaDevices","getUserMedia","audio","facingMode","max","mediaStream","srcObject","play","Promise","r","onloadedmetadata","render","symbols","footer","ctx","getContext","clearRect","firstChild","removeChild","lastChild","font","strokeStyle","fillStyle","lineWidth","i","length","sym","points","beginPath","j","x","y","moveTo","lineTo","closePath","stroke","fillText","div","createElement","className","innerText","typeName","decode","appendChild","scan","drawImage","imgData","getImageData","scanImageData","res","sleep","ms","setTimeout","body","console","error","main"],"mappings":"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","file":"static/js/main.44837147.chunk.js","sourcesContent":["import { scanImageData } from 'zbar.wasm';\n\nconst SCAN_PROID_MS = 800;\n\nconst handleResize = () => {\n  const width = document.documentElement.clientWidth;\n  const height = document.documentElement.clientHeight;\n  const video = document.getElementById('video');\n  video.width = width;\n  video.height = height;\n\n  const canvas = document.getElementById('canvas');\n  canvas.width = video.videoWidth;\n  canvas.height = video.videoHeight;\n  if (width / video.videoWidth < height / video.videoHeight) {\n    canvas.style.width = '100vw';\n    canvas.style.height = 'auto';\n  } else {\n    canvas.style.width = 'auto';\n    canvas.style.height = '100vh';\n  }\n};\n\nconst init = async () => {\n  window.onresize = handleResize;\n  const mediaStream = await navigator.mediaDevices.getUserMedia({\n      audio: false,\n      video: {\n        facingMode: 'environment',\n        width: { max: 640 },\n        height: { max: 640 }\n      }\n    });\n  const video = document.getElementById('video');\n  video.srcObject = mediaStream;\n  video.play();\n  await new Promise(r => {\n    video.onloadedmetadata = r;\n  });\n  handleResize();\n};\n\nconst render = (symbols) => {\n  const canvas = document.getElementById('canvas');\n  const footer = document.getElementById('footer');\n  const ctx = canvas.getContext('2d');\n  const width = canvas.width;\n  const height = canvas.height;\n  ctx.clearRect(0, 0, width, height);\n  while (footer.firstChild) {\n    footer.removeChild(footer.lastChild);\n  }\n  ctx.font = '20px serif';\n  ctx.strokeStyle = '#00ff00';\n  ctx.fillStyle = '#ff0000';\n  ctx.lineWidth = 6;\n  for (let i = 0; i < symbols.length; ++i) {\n    const sym = symbols[i];\n    const points = sym.points;\n    ctx.beginPath();\n    for (let j = 0; j < points.length; ++j) {\n      const { x, y } = points[j];\n      if (j === 0) {\n        ctx.moveTo(x, y);\n      } else {\n        ctx.lineTo(x, y);\n      }\n    }\n    ctx.closePath();\n    ctx.stroke();\n    ctx.fillText('#' + i, points[0].x, points[0].y - 10);\n\n    const div = document.createElement('div');\n    div.className = 'footerItem';\n    div.innerText = `#${i}: Type: ${sym.typeName}; Value: \"${sym.decode()}\"`\n    footer.appendChild(div);\n  }\n};\n\nconst scan = async () => {\n  const canvas = document.createElement('canvas');\n  const video = document.getElementById('video');\n  const width = video.videoWidth;\n  const height = video.videoHeight;\n  canvas.width = width;\n  canvas.height = height;\n  const ctx = canvas.getContext('2d');\n  ctx.drawImage(video, 0, 0, width, height);\n  const imgData = ctx.getImageData(0, 0, width, height);\n  const res = await scanImageData(imgData);\n  // console.log(res, Date.now());\n  render(res);\n};\n\nconst sleep = ms => new Promise(r => { setTimeout(r, ms) });\n\nconst main = async () => {\n  try {\n    await init();\n    while (true) {\n      await scan();\n      await sleep(SCAN_PROID_MS);\n    }\n  } catch (err) {\n    const div = document.createElement('div');\n    div.className = 'full middle';\n    div.style = 'height: 72px; width: 100%; text-align: center; font-size: 36px';\n    div.innerText = 'Cannot get cammera: ' + err;\n    document.body.appendChild(div);\n    console.error(err);\n  }\n};\n\nmain();"],"sourceRoot":""}